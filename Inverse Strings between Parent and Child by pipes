#include <stdio.h>
#include <sys/wait.h>
#include <assert.h>
#include <stdlib.h>
#include <unistd.h>
#include <string>

using namespace std;

void inverseStr(string &s) {
    for(int x = 0; x < s.length(); x++) {
        if(s[x] >= 'A' && s[x] <= 'Z') {
            s[x] += 32;
        } else if(s[x] >= 'a' && s[x] <= 'z') {
            s[x] -= 32;
        }
    }
}

int main() {

    int sendfd[2];
    int recfd[2];
    
    pid_t pid;
    char buf;

    if(pipe(sendfd) == -1) {
        perror("pipe");
        exit(EXIT_FAILURE);
    }

    if(pipe(recfd) == -1) {
        perror("pipe");
        exit(EXIT_FAILURE);
    }

    pid = fork();
    if(pid == -1) {
        perror("fork");
    } else if(pid == 0) {
        string str;
        close(recfd[0]);
        close(sendfd[1]);
        while(read(sendfd[0], &buf, 1) > 0) {
            str += buf;
        }
        close(sendfd[0]);
        inverseStr(str);
        write(recfd[1], str.c_str(), str.length());
        close(recfd[1]);
        exit(EXIT_SUCCESS);
    } else {
        close(recfd[1]);
        close(sendfd[0]);
        string str = "Test Sample";
        write(sendfd[1], str.c_str(), str.length());
        close(sendfd[1]);
        string str2 = "";
        close(recfd[1]);
        while(read(recfd[0], &buf, 1) > 0) {
            str2 += buf;
        }
        printf(str2.c_str(), str2.length());
        exit(EXIT_SUCCESS);
    }


}
